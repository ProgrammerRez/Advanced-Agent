# ============================================================
# netlify.toml — Netlify build & functions configuration
# ============================================================

# ----------------------------------------------------------
# Build settings
# ----------------------------------------------------------
[build]
  # Static HTML served as-is (no frontend build step).
  publish = "."

  # Install Python runtime dependencies during build.
  command = "pip install -r requirements.txt"

# ----------------------------------------------------------
# Functions directory (modern key — takes priority over
# the legacy [build] functions key)
# ----------------------------------------------------------
[functions]
  directory = "netlify/functions"

# Python 3.11 runtime for the `api` function.
# NOTE: Do NOT set node_bundler here — that forces JS bundling
# and causes Netlify to skip .py files entirely.
[functions."api"]
  runtime = "python3.11"

# ----------------------------------------------------------
# URL rewrites — clean public-facing paths
# ----------------------------------------------------------
# All /api/* traffic → the serverless function
[[redirects]]
  from   = "/api/*"
  to     = "/.netlify/functions/api/:splat"
  status = 200

# Legacy POST endpoint used by the frontend
[[redirects]]
  from   = "/research_agent"
  to     = "/.netlify/functions/api/research_agent"
  status = 200

# Convenience health-check shortcut
[[redirects]]
  from   = "/health"
  to     = "/.netlify/functions/api/health"
  status = 200
